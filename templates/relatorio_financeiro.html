<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Relatório Financeiro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        body { background: #525659; font-family: 'Poppins', sans-serif; display: flex; justify-content: center; padding: 20px; }
        
        .page {
            background: white; width: 21cm; min-height: 29.7cm; padding: 1.5cm;
            box-shadow: 0 0 10px rgba(0,0,0,0.3); position: relative;
        }

        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #0e7490; padding-bottom: 15px; margin-bottom: 20px; }
        .company-info h1 { margin: 0; color: #0e7490; font-size: 1.4rem; }
        .company-info p { margin: 0; font-size: 0.8rem; color: #555; }
        
        .report-title { text-align: right; }
        .report-title h2 { margin: 0; text-transform: uppercase; font-size: 1.1rem; }
        .periodo { font-size: 0.9rem; color: #666; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
        th { background: #f3f4f6; padding: 8px; text-align: left; border-bottom: 2px solid #ddd; }
        td { padding: 8px; border-bottom: 1px solid #eee; }
        
        .text-green { color: #059669; font-weight: 600; }
        .text-red { color: #dc2626; font-weight: 600; }
        
        .resumo-box { display: flex; justify-content: flex-end; margin-top: 20px; gap: 20px; }
        .box { background: #f9fafb; padding: 15px; border-radius: 8px; min-width: 150px; text-align: right; }
        .box span { display: block; font-size: 0.8rem; color: #666; }
        .box strong { font-size: 1.1rem; }

        /* Botão Flutuante */
        .no-print { position: fixed; top: 20px; right: 20px; }
        .btn-print { background: #0e7490; color: white; border: none; padding: 12px 25px; border-radius: 30px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        @media print {
            body { background: white; padding: 0; }
            .page { box-shadow: none; width: 100%; margin: 0; padding: 0; }
            .no-print { display: none; }
            @page { margin: 1cm; }
        }
    </style>
</head>
<body>

    <div class="no-print">
        <button onclick="window.print()" class="btn-print"><i class="ph ph-printer"></i> Imprimir / Salvar PDF</button>
    </div>

    <div class="page">
        <div class="header">
            <div class="company-info">
                <h1>{{ empresa['empresa_nome'] }}</h1>
                <p>CNPJ: {{ empresa['empresa_cnpj'] }}</p>
                <p>Gerado em: {{ data_inicio }}</p>
            </div>
            <div class="report-title">
                <h2>Relatório Financeiro</h2>
                <div class="periodo">De <strong>{{ data_inicio }}</strong> até <strong>{{ data_fim }}</strong></div>
            </div>
        </div>

        <h3>Extrato Detalhado</h3>
        <table>
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Descrição</th>
                    <th>Tipo</th>
                    <th style="text-align: right;">Valor</th>
                </tr>
            </thead>
            <tbody>
                {% for item in itens %}
                <tr>
                    <td>{{ item['data'].split('-')[2] }}/{{ item['data'].split('-')[1] }}</td>
                    <td>{{ item['descricao'] }}</td>
                    <td>
                        {% if item['tipo'] == 'Entrada' %} 
                            <span style="background:#dcfce7; color:#166534; padding:2px 6px; border-radius:4px; font-size:0.7rem;">Entrada</span>
                        {% else %} 
                            <span style="background:#fee2e2; color:#991b1b; padding:2px 6px; border-radius:4px; font-size:0.7rem;">Saída</span>
                        {% endif %}
                    </td>
                    <td style="text-align: right;">
                        {% if item['tipo'] == 'Entrada' %}
                            <span class="text-green">+ R$ {{ "%.2f"|format(item['valor']) }}</span>
                        {% else %}
                            <span class="text-red">- R$ {{ "%.2f"|format(item['valor']) }}</span>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="4" style="text-align:center; padding:20px;">Nenhuma movimentação neste período.</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="resumo-box">
            <div class="box">
                <span>Total Entradas</span>
                <strong class="text-green">R$ {{ "%.2f"|format(total_entradas) }}</strong>
            </div>
            <div class="box">
                <span>Total Saídas</span>
                <strong class="text-red">R$ {{ "%.2f"|format(total_saidas) }}</strong>
            </div>
            <div class="box" style="border: 2px solid #0e7490; background: white;">
                <span>Saldo do Período</span>
                <strong style="color: #0e7490;">R$ {{ "%.2f"|format(saldo) }}</strong>
            </div>
        </div>

        <div style="margin-top: 50px; border-top: 1px solid #ccc; text-align: center; padding-top: 10px; font-size: 0.8rem; color: #999;">
            Documento para controle interno.
        </div>
    </div>
<script src="static/script.js"></script>
</body>
</html>