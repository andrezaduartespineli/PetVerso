<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Pet Verso</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="/static/style.css">

    <style>
      
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .header h1 { font-size: 1.8rem; }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .avatar { width: 40px; height: 40px; background-color: var(--accent-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;}

        /* CARDS */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .card { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .card-title { font-size: 0.9rem; color: var(--text-light); margin-bottom: 0.5rem; }
        .card-value { font-size: 1.8rem; font-weight: 600; color: var(--text-dark); }
        .card-icon { float: right; font-size: 2rem; color: var(--primary-color); opacity: 0.2; }

        /* TABELA */
        .recent-section { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .section-title { font-size: 1.1rem; margin-bottom: 1rem; display: flex; justify-content: space-between; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th { text-align: left; color: var(--text-light); font-weight: 400; padding-bottom: 1rem; font-size: 0.9rem; }
        td { padding: 1rem 0; border-bottom: 1px solid #f3f4f6; font-size: 0.95rem; }
        .status { padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .status.pendente { background-color: #fef3c7; color: #d97706; }
        .status.banho { background-color: #ecfeff; color: #0e7490; }
        /* Adicione isso no seu bloco <style> */

    </style>
</head>
<body>
    <nav class="sidebar">
    <div class="sidebar-header">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo-circulo">
    </div>
    
    <a href="/dashboard" class="menu-item"><i class="ph ph-squares-four"></i> Visão Geral</a>

    {% if tem_permissao('agenda') %}
    <a href="/agenda" class="menu-item"><i class="ph ph-calendar-check"></i> Agenda</a>
    {% endif %}

    {% if tem_permissao('clientes') %}
    <a href="/clientes" class="menu-item"><i class="ph ph-users"></i> Clientes</a>
    {% endif %}

    {% if tem_permissao('servicos') %}
    <a href="/servicos" class="menu-item"><i class="ph ph-scissors"></i> Serviços</a>
    {% endif %}

    {% if tem_permissao('financeiro') %}
    <a href="/financeiro" class="menu-item"><i class="ph ph-money"></i> Financeiro</a>
    {% endif %}

    {% if tem_permissao('estoque') %}
    <a href="/estoque" class="menu-item"><i class="ph ph-package"></i> Estoque</a>
    {% endif %}

    {% if session['cargo'] == 'gerente' %}
    <a href="/equipa" class="menu-item"><i class="ph ph-identification-badge"></i> Equipa</a>
    {% endif %}

    <a href="/configuracoes" class="menu-item"><i class="ph ph-gear"></i> Configurações</a>

    <div style="margin-top: auto;">
        <a href="/logout" class="menu-item"><i class="ph ph-sign-out"></i> Sair</a>
    </div>
</nav>

    <main class="main-content">
        <header class="header">
            <div>
                <h1 style="color: var(--primary-color);">
             Olá, {{ session.get('nome', 'Gestor').split()[0] }}!
         </h1>
         <p style="color: var(--text-light);">Resumo do dia no Pet Verso.</p>
            </div>
             </header>

        <div class="stats-grid">
            <div class="card">
    <i class="ph ph-calendar card-icon"></i>
    <div class="card-title">Agendamentos Hoje</div>
    <div class="card-value">{{ total_agendamentos }}</div> 
    <small style="color: green; font-size: 0.8rem;">Data: Hoje</small>
</div>

<div class="card">
    <i class="ph ph-currency-dollar card-icon"></i>
    <div class="card-title">Faturamento Diário</div>
    <div class="card-value">R$ {{ "%.2f"|format(faturamento) }}</div>
    <small style="color: var(--text-light); font-size: 0.8rem;">Entradas Confirmadas</small>
</div>

<div class="card">
    <i class="ph ph-drop card-icon"></i>
    <div class="card-title">Estoque Crítico</div>
    <div class="card-value">{{ estoque_critico }}</div>
    <small style="color: red; font-size: 0.8rem;">Itens abaixo do mínimo</small>
</div>
        </div>

        <div class="recent-section">
            <div class="section-title">
                <span>Próximos da Fila (Agenda)</span>
                <a href="/agenda" style="text-decoration: none; color: var(--primary-color); font-size: 0.9rem;">Ver Agenda Completa</a>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Horário</th>
                        <th>Pet</th>
                        <th>Serviço</th>
                        <th>Tutor</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
    {% for item in proximos %}
    <tr>
        <td>{{ item['hora'] }}</td>
        <td><strong>{{ item['nome_pet'] }}</strong></td>
        <td>{{ item['servico'] }}</td>
        
        <td>
            {% if item['status'] == 'Concluído' %}
                <span class="status banho" style="background:#ecfdf5; color:#059669;">Concluído</span>
            {% else %}
                <span class="status pendente">Agendado</span>
            {% endif %}
        </td>
    </tr>
    {% else %}
    <tr>
        <td colspan="5" style="text-align:center; color:#999; padding:20px;">
            Nenhum agendamento para hoje.
        </td>
    </tr>
    {% endfor %}
</tbody>
            </table>
        </div>
    </main>
</body>
</html>