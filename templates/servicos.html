<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serviços - Pet Verso</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="/static/style.css">

    <style>
      
        .header-area { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        
        /* CARD DE TAXA (NOVO) */
        .taxa-card { 
            background: #ecfeff; border: 1px solid #bce3eb; padding: 1.5rem; border-radius: 12px; 
            display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;
        }

        table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        th { text-align: left; background: #f9fafb; padding: 1rem; color: #9ca3af; }
        td { padding: 1rem; border-bottom: 1px solid #f3f4f6; }

        .btn-add { background: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        
        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal { background: white; width: 400px; padding: 2rem; border-radius: 12px; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; }
    </style>
</head>
<body>

     <nav class="sidebar">
    <div class="sidebar-header">
        <img src="{{ url_for('static', filename='logo.png') }}?v={{ cache_buster }}" alt="Logo" class="logo-circulo">
    </div>
    
    <a href="/dashboard" class="menu-item"><i class="ph ph-squares-four"></i> Visão Geral</a>

    {% if tem_permissao('agenda') %}
    <a href="/agenda" class="menu-item"><i class="ph ph-calendar-check"></i> Agenda</a>
    {% endif %}

    {% if tem_permissao('clientes') %}
    <a href="/clientes" class="menu-item"><i class="ph ph-users"></i> Clientes</a>
    {% endif %}

    <a href="/lembretes" class="menu-item"><i class="ph ph-bell-ringing"></i> Lembretes</a>

    {% if tem_permissao('servicos') %}
    <a href="/servicos" class="menu-item"><i class="ph ph-scissors"></i> Serviços</a>
    {% endif %}

    {% if tem_permissao('financeiro') %}
    <a href="/financeiro" class="menu-item"><i class="ph ph-money"></i> Financeiro</a>
    {% endif %}

    {% if tem_permissao('estoque') %}
    <a href="/estoque" class="menu-item"><i class="ph ph-package"></i> Estoque</a>
    {% endif %}

    {% if session['cargo'] == 'gerente' %}
    <a href="/equipa" class="menu-item"><i class="ph ph-identification-badge"></i> Equipa</a>
    {% endif %}

    {% if session['cargo'] == 'gerente' %}
    <a href="/configuracoes" class="menu-item"><i class="ph ph-gear"></i> Configurações</a>
{% endif %}

    <div style="margin-top: auto;">
        <a href="/logout" class="menu-item"><i class="ph ph-sign-out"></i> Sair</a>
    </div>
</nav>

    <main class="main-content">
        
        <div class="header-area">
            <div>
                <h1>Serviços & Taxas</h1>
                <p style="color: #666;">Gerencie os preços do Pet Shop.</p>
            </div>
        </div>

        <div class="taxa-card">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="background: white; padding: 10px; border-radius: 50%; color: var(--primary-color); font-size: 1.5rem;">
                    <i class="ph ph-taxi"></i>
                </div>
                <div>
                    <h3 style="margin: 0; color: #0e7490;">Taxi Dog (Busca e Leva)</h3>
                    <p style="margin: 0; color: #555; font-size: 0.9rem;">Valor fixo adicionado automaticamente na agenda.</p>
                </div>
            </div>
            <div style="text-align: right;">
                <span style="display: block; font-size: 1.5rem; font-weight: bold; color: var(--primary-color);">
                    R$ {{ "%.2f"|format(preco_taxi) }}
                </span>
                <button onclick="document.getElementById('modalTaxi').style.display='flex'" 
                        style="background: white; border: 1px solid #0e7490; color: #0e7490; padding: 5px 15px; border-radius: 6px; cursor: pointer; margin-top: 5px; font-weight: 600;">
                    Alterar Valor
                </button>
            </div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h3>Catálogo de Serviços</h3>
            <button onclick="document.getElementById('modalServico').style.display='flex'" class="btn-add">
                <i class="ph ph-plus"></i> Novo Serviço
            </button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Duração</th>
                    <th>Valor</th>
                </tr>
            </thead>
            <tbody>
                {% for servico in servicos %}
                <tr>
                    <td style="font-weight: 600;">{{ servico['nome'] }}</td>
                    <td>{{ servico['duracao_minutos'] }} min</td>
                    <td style="color: var(--primary-color); font-weight: bold;">R$ {{ "%.2f"|format(servico['valor']) }}</td>
                </tr>
                {% else %}
                <tr><td colspan="3" style="text-align: center; padding: 2rem; color: #999;">Nenhum serviço cadastrado.</td></tr>
                {% endfor %}
            </tbody>
        </table>

    </main>

    <div id="modalServico" class="modal-overlay">
        <div class="modal">
            <h2 style="color: var(--primary-color);">Novo Serviço</h2>
            <form action="/servicos" method="POST">
                <label>Nome do Serviço</label>
                <input type="text" name="nome" placeholder="Ex: Banho Premium" required>
                <label>Valor (R$)</label>
                <input type="number" step="0.01" name="valor" required>
                <label>Duração (Minutos)</label>
                <input type="number" name="duracao" value="30">
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 1rem;">
                    <button type="button" onclick="document.getElementById('modalServico').style.display='none'" style="background: #eee; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Cancelar</button>
                    <button type="submit" style="background: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalTaxi" class="modal-overlay">
        <div class="modal">
            <h2 style="color: var(--primary-color); display: flex; align-items: center; gap: 10px;">
                <i class="ph ph-taxi"></i> Valor do Taxi Dog
            </h2>
            <form action="/atualizar_taxi" method="POST">
                <p style="color: #666; font-size: 0.9rem;">Este valor será somado a todos os agendamentos marcados como "Taxi Dog".</p>
                <label>Novo Valor (R$)</label>
                <input type="number" step="0.01" name="valor_taxi" value="{{ preco_taxi }}" required style="font-size: 1.2rem; font-weight: bold; color: var(--primary-color);">
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 1rem;">
                    <button type="button" onclick="document.getElementById('modalTaxi').style.display='none'" style="background: #eee; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Cancelar</button>
                    <button type="submit" style="background: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Atualizar</button>
                </div>
            </form>
        </div>
    </div>
<script src="static/script.js"></script>
</body>
</html>